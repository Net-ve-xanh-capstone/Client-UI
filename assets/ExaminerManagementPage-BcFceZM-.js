import{$ as q,j as e,b6 as p,bC as H,r,s as E,M as c,bD as C,aY as L,bE as G,bF as K,v as I,bG as $,bH as v,u as W,bI as Q,bq as U,bJ as Y,bK as J,f as X,I as V,bL as Z,bM as ee}from"./index-Cxj7Cc13.js";import{P as te,D as ae}from"./DashboardCard-0KuSiJ63.js";import{b as ne,i as se,c as oe}from"./adminApi-D_RYfx-5.js";import{r as re,e as ie}from"./Status-GYzEMVEP.js";import{c as le,a as f,b as ce,o as de}from"./object-DPdtQ5gw.js";import{a as he,b as me,c as ue,R as pe}from"./Regex-C3CFNc-J.js";import"./Box-vCVWR2SX.js";const ge=q(e.jsx("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8m0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4z"}),"Loop");function be({show:s,setShow:l,title:b,callBack:m,status:x}){const u=()=>l(!1),j=()=>{u(),m()};return e.jsx(e.Fragment,{children:e.jsxs(p,{show:s,onHide:u,backdrop:"static",keyboard:!1,children:[e.jsx(p.Header,{closeButton:!0,children:e.jsx(p.Title,{children:`${x==="Active"?"Khóa":"Mở khóa"} ${b}`})}),e.jsx(p.Body,{children:`Bạn có chắc chắn muốn ${x==="Active"?"khóa":"mở khóa"} ${b} này?`}),e.jsxs(p.Footer,{children:[e.jsx(H,{variant:"secondary",size:"lg",onClick:u,children:"Không"}),e.jsx(H,{variant:"danger",size:"lg",onClick:()=>j(),children:"Có"})]})]})})}const xe="_btnCreate_1vzyn_1",ye="_buttonContainer_1vzyn_16",fe="_title_1vzyn_82",je="_titleHeader_1vzyn_89",ke="_modalForm_1vzyn_95",Ce="_inputModal_1vzyn_113",Ne="_btnAdd_1vzyn_117",we="_formControl_1vzyn_131",_e="_error_1vzyn_135",d={btnCreate:xe,buttonContainer:ye,title:fe,titleHeader:je,modalForm:ke,inputModal:Ce,btnAdd:Ne,formControl:we,error:_e,"react-datepicker__input-container":"_react-datepicker__input-container_1vzyn_140"},Se=r.forwardRef(({modalShow:s,toggle:l},b)=>{var _,S,t,o,n,z;const m=new Date,[x,u]=r.useState(m),j=[{value:"0",label:"Nam"},{value:"1",label:"Nữ"}];r.useImperativeHandle(b,()=>({handleOpen:()=>{T(),l(),u(m)}}));const M=le().shape({fullName:f().required("Vui lòng nhập họ tên"),username:f().required("Vui lòng nhập username"),email:f().matches(he,"Email không hợp lệ").required("Vui lòng nhập email của bạn"),phone:f().matches(me,"Số điện thoại không hợp lệ").required("Vui lòng nhập số điện thoại của bạn"),password:f().required("Vui lòng nhập mật khẩu của bạn").matches(ue,"Mật khẩu của bạn phải chứa 8 ký tự, bao gồm một chữ hoa, một chữ thường, một chữ số và một ký tự đặc biệt."),gender:ce().required("Vui lòng chọn giới tính").typeError("Vui lòng chọn giới tính"),birthday:f().required("Vui lòng chọn ngày sinh").typeError("Vui lòng chọn ngày sinh")}),{control:h,formState:{errors:a},reset:T,handleSubmit:N,setValue:w,trigger:A}=E({resolver:de(M)}),B=async i=>{if(!await A())return;const O=new Date(i.birthday).toISOString(),F={...i,birthday:O,address:"N/A",role:I.STAFF};await $(F).then(y=>{var R;const P=(R=y==null?void 0:y.data)==null?void 0:R.message;v.success(P,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),l()}).catch(y=>{const P=y.response?y.response.data.message:"Đã xảy ra lỗi.";v.error(P,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})})},k=i=>{(i.key==="e"||i.key==="-"||i.key==="+"||i.key==="E"||i.key===".")&&i.preventDefault()},D=r.useCallback(i=>{w("birthday",i,{shouldDirty:!0}),u(i)},[w]);return e.jsx(e.Fragment,{children:e.jsxs(p,{show:s,onHide:l,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[e.jsx(p.Header,{closeButton:!0,style:{margin:"0 auto"},children:e.jsx(p.Title,{id:"contained-modal-title-vcenter",style:{fontWeight:"bold",fontSize:"22px",margin:0,padding:0},children:"Tạo tài khoản của staff"})}),e.jsx(p.Body,{style:{height:"70vh",overflow:"hidden"},children:e.jsxs("form",{onSubmit:N(B),className:d.modalForm,children:[e.jsxs(c,{container:!0,spacing:2,children:[e.jsxs(c,{item:!0,md:6,children:[e.jsx("h4",{className:d.title,children:"Họ và tên"}),e.jsx(C,{control:h,id:"fullName",name:"fullName",error:(_=a==null?void 0:a.fullName)==null?void 0:_.message,"aria-required":"true",type:"text",placeholder:"Nhập họ và tên"})]}),e.jsxs(c,{item:!0,md:6,children:[e.jsx("h4",{className:d.title,children:"Email"}),e.jsx(C,{control:h,error:(S=a==null?void 0:a.email)==null?void 0:S.message,id:"email",name:"email","aria-required":"true",type:"email",placeholder:"Nhập email"})]})]}),e.jsxs(c,{container:!0,spacing:2,children:[e.jsxs(c,{item:!0,md:4,children:[e.jsx("h4",{className:d.title,children:"Số điện thoại"}),e.jsx(C,{control:h,id:"phone",name:"phone",error:(t=a==null?void 0:a.phone)==null?void 0:t.message,"aria-required":"true",type:"number",placeholder:"Nhập số điện thoại",onKeyDown:k})]}),e.jsxs(c,{sx:{height:"0%"},item:!0,md:4,children:[e.jsx("h4",{className:d.title,children:"Ngày sinh"}),e.jsx(L,{name:"birthday",control:h,defaultValue:m,render:()=>e.jsx(G,{selected:x,dateFormat:"dd/MM/yyyy",placeholderText:"Chọn ngày sinh",maxDate:m,onChange:D})})]}),e.jsxs(c,{item:!0,md:4,children:[e.jsx("h4",{className:d.title,children:"Giới tính"}),e.jsx(pe,{control:h,error:(o=a==null?void 0:a.gender)==null?void 0:o.message,defaultValue:!1,name:"gender",valueArray:j})]})]}),e.jsx(c,{container:!0,spacing:2,children:e.jsxs(c,{item:!0,md:12,children:[e.jsx("h4",{className:d.title,children:"Username"}),e.jsx(C,{control:h,id:"username",name:"username",error:(n=a==null?void 0:a.username)==null?void 0:n.message,"aria-required":"true",type:"text",placeholder:"Nhập tên đăng nhập"})]})}),e.jsx(c,{container:!0,spacing:2,children:e.jsxs(c,{item:!0,md:12,children:[e.jsx("h4",{className:d.title,children:"Mật khẩu"}),e.jsx(C,{control:h,id:"password",error:(z=a.password)==null?void 0:z.message,name:"password","aria-required":"true",type:"password",placeholder:"Nhập mật khẩu"})]})}),e.jsx("div",{style:{textAlign:"end"},children:e.jsx(K,{type:"submit",className:d.btnAdd,size:"large",loadingPosition:"center",variant:"contained",children:e.jsx("span",{style:{fontWeight:"bold",fontSize:"14px"},children:"Thêm"})})})]})})]})})}),g=(s,l=20)=>e.jsx(ee,{title:s,children:e.jsx("span",{children:s&&s.length>l?s.substring(0,l)+"...":s})}),ve=()=>J({typography:{fontSize:20},palette:{background:{default:"#0f172a"},mode:"light"},components:{MuiTableCell:{styleOverrides:{head:{padding:"10px 10px",fontWeight:"bold",borderBottom:"1px solid black"},body:{color:"#000",fontWeight:"bold",borderBottom:"1px solid black"}}}}}),He=()=>{const{userInfo:s}=W(t=>t.auth),[l,b]=r.useState([]),[m,x]=r.useState(null),[u,j]=r.useState(""),[M,h]=r.useState(!1),[a,T]=r.useState(!1),N=r.useRef(null);r.useEffect(()=>{k()},[]);const w=t=>{const o=l.find(n=>n.id===t).status;j(o),x(t),h(!0)},A={searchPlaceholder:"Tìm kiếm theo họ và tên, email, số điện thoại",selectableRows:"none",elevation:5,rowsPerPage:4,rowsPerPageOptions:[4,10,20,30],responsive:"standard",print:!1,download:!1,filter:!1,textLabels:{body:{noMatch:"Không có dữ liệu"},pagination:{rowsPerPage:"Số hàng mỗi trang:",displayRows:"của"},toolbar:{search:"Tìm kiếm",viewColumns:"Xem cột",filterTable:"Lọc bảng"}},onRowClick:(t,o)=>{}},B=[{name:"fullName",label:"HỌ VÀ TÊN",options:{customBodyRender:t=>g(t,30)}},{name:"email",label:"EMAIL",options:{customBodyRender:t=>g(t,20)}},{name:"phone",label:"SỐ ĐIỆN THOẠI",textAlign:"left",options:{customBodyRender:t=>g(t)}},{name:"birthday",label:"NGÀY SINH",options:{customBodyRender:t=>g(X(t))}},{name:"gender",label:"GIỚI TÍNH",options:{customBodyRender:t=>g(t?"Nữ":"Nam")}},{name:"role",label:"VAI TRÒ",options:{customBodyRender:t=>{const o=re[t]||t;return g(o)}}},{name:"status",label:"TRẠNG THÁI",options:{customBodyRender:t=>{const o=ie[t]||t;return g(o)}}},{name:"id",label:"TƯƠNG TÁC",options:{customBodyRender:(t,o)=>e.jsxs("span",{children:[e.jsx("span",{style:{display:"none"},name:"id",children:t}),s&&(s==null?void 0:s.role)===I.ADMIN&&e.jsx(V,{"aria-label":"delete",size:"small",style:{height:"30px",width:"30px"},color:"error",onClick:n=>{n.stopPropagation(),w(t)},children:e.jsx(ge,{})}),e.jsx(V,{"aria-label":"delete",style:{height:"30px",width:"30px"},size:"small",color:"info",children:e.jsx(Z,{})})]})}}],k=async()=>{try{const{data:t}=await ne(),o=t==null?void 0:t.result.map(n=>({id:n.id,username:n.username,birthday:n.birthday,fullName:n.fullName,email:n.email,address:n.address,phone:n.phone,gender:n.gender,role:n.role,status:n.status}));b(o)}catch(t){console.log(t)}},D=async()=>{try{if(u==="Active"){const{data:t}=await se(m);t!=null&&t.result&&(v.success("Khóa tài khoản thành công",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),k())}else{const{data:t}=await oe(m);t!=null&&t.result&&(v.success("Mở khóa tài khoản thành công",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}),k())}}catch(t){console.log("err",t)}},_=r.useCallback(()=>{T(t=>!t)},[]),S=r.useCallback(()=>{var t;(t=N.current)==null||t.handleOpen()},[]);return e.jsxs(te,{title:"Quản lý giám khảo",description:"Quản lý giám khảo",children:[e.jsxs(ae,{title:"Quản lý giám khảo",action:e.jsx("div",{className:d.buttonContainer,children:e.jsx("button",{className:d.btnCreate,onClick:S,children:e.jsx("span",{children:"Tạo tài khoản cho Staff"})})}),children:[e.jsx(Q,{injectFirst:!0,children:e.jsx(U,{theme:ve(),children:e.jsx("span",{className:"table-contest table-contest-detail",children:e.jsx(Y,{data:l,columns:B,options:A})})})}),e.jsx(be,{show:M,setShow:h,title:"tài khoản",callBack:D,status:u})]}),e.jsx(Se,{ref:N,modalShow:a,toggle:_})]})};export{He as default};
