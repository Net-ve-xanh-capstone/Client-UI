import{x,y as H,r,a as $,j as e,L as N}from"./index-CzsKRG-n.js";import{H as J}from"./HeaderVersion2-DQNBoE01.js";import{a as M}from"./TooltipMenu-D1Fw0Oyp.js";/* empty css                   */import{d as X}from"./imageDefault-DrZ7cyyx.js";import{u as z}from"./useUploadImage-BOedqHXQ.js";import{c as K,d as Q,a as b,o as W}from"./object-C7CanEG5.js";import{u as Y}from"./index.esm-Nahw02Rg.js";import{T as Z}from"./TextfieldCommon-SUf-CWkP.js";import{T as _,S as p}from"./sweetalert2.all-C-3cDrzf.js";import{D as u}from"./index-izChEObK.js";import{c as ee}from"./index-BNfnTDOO.js";import"./Transition-gznGVM9Z.js";import"./Tooltip-DK2Y3a_7.js";import"./config-VkUvCR_3.js";const te={getAllTopic:async(i,a,c,d)=>await x.get(i,{params:{AccountId:a,ContestId:c},...d})},B={postPainting:async(i,a,c)=>await x.post(i,a,c),getAllPaintingByContestAccountId:async(i,a,c)=>await x.get(i,{params:{contestId:a,accountId:c}}),updatePainting:async(i,a,c)=>await x.put(i,a,c)},se="paintings/draftepainting1stround",ae="paintings/submitepainting1stround",ie="paintings/getpaintingbyaccountcontest",Ie=()=>{var S,C,L,D;const{contestId:i}=H(),[a,c]=r.useState(null),[d,g]=r.useState(null),[f,m]=r.useState([]),[j,v]=r.useState(null),[ne,E]=r.useState(!1),{progress:ce,url:y,error:re}=z(d),n=$(s=>s.auth.userInfo),V=new Date().toISOString().slice(0,10);r.useEffect(()=>{(async()=>{const t=await te.getAllTopic("roundtopics/getalltopic",n.Id,i);m(t.data.result)})()},[]);const R=K().shape({file:Q().required("Vui lòng chọn ảnh"),name:b().required("Vui lòng nhập tên của bức tranh"),description:b(),topic:b().required("Vui lòng chọn chủ đề")}),{handleSubmit:I,control:w,setValue:o,trigger:T,watch:k,setError:P,formState:{errors:l}}=Y({resolver:W(R),reValidateMode:"onChange"}),O=s=>{const t=s.target.files[0];t.preview=URL.createObjectURL(t),c(URL.createObjectURL(t)),o("file",t),P("file",""),g(t)},U=async s=>{if(!await T())return;const h={image:y||a,name:s.name,description:s.description,roundTopicId:j,accountId:n.Id};A("Bạn có chắc chắn lưu bài?",se,h,"Lưu bài thành công","Lưu bài thất bại","Bạn đã hủy lưu bài")},F=async s=>{if(!await T())return;const h={image:y||a,name:s.name,description:s.description,roundTopicId:j,accountId:n.Id};A("Bạn có chắc chắn nộp bài?",ae,h,"Nộp bài thành công","Nộp bài thất bại","Bạn đã hủy nộp bài")},G=(s,t="")=>k(s)||t,q=(s,t)=>{o(s,t.name),v(t.id),P(s,"")};return r.useEffect(()=>()=>{a&&URL.revokeObjectURL(a.preview)},[a,n==null?void 0:n.Id]),r.useEffect(()=>{B.getAllPaintingByContestAccountId(ie,i,n==null?void 0:n.Id).then(s=>{const t=s.data.result;c(t.image),o("name",t.name),o("description",t.description),o("topic",t.topicName),v(t.roundTopicId),o("file",t.image),(t==null?void 0:t.status)===1&&E(!0)})},[n==null?void 0:n.Id,i]),e.jsxs("div",{className:"create-item",children:[e.jsx(J,{}),e.jsxs("section",{className:"flat-title-page inner",children:[e.jsx("div",{className:"overlay"}),e.jsx("div",{className:"themesflat-container",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-md-12",children:[e.jsx("div",{className:"page-title-heading mg-bt-12",children:e.jsx("h1",{className:"heading text-center",children:"Đăng ký tham gia"})}),e.jsx("div",{className:"breadcrumbs style2",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(N,{to:"/",children:"Trang chủ"})}),e.jsx("li",{children:e.jsx(N,{to:"#",children:"Trang"})}),e.jsx("li",{children:"Đăng ký"})]})})]})})})]}),e.jsx("div",{className:"tf-create-item tf-section",children:e.jsx("div",{className:"themesflat-container",children:e.jsxs("div",{className:"row",children:[a&&e.jsxs("div",{className:"col-xl-3 col-lg-6 col-md-6 col-12",children:[e.jsx("h4",{style:{marginBottom:"20px"},className:"title-create-item",children:"Xem trước"}),e.jsxs("div",{className:"sc-card-product",children:[e.jsx("div",{className:"card-media",children:e.jsx(N,{className:"cursor-none",to:"#",children:e.jsx("img",{src:a||X,alt:"preview"})})}),e.jsxs("div",{className:"meta-info",children:[e.jsx("div",{className:"author",children:e.jsxs("div",{className:"text",children:[e.jsx("span",{children:"Tác giả"}),e.jsx("h5",{children:n.nameid})]})}),e.jsxs("div",{className:"text",children:[e.jsx("span",{children:"Ngày nộp"}),e.jsx("h5",{children:V})]})]})]})]}),e.jsx("div",{className:`${a?"col-xl-9 col-lg-6 col-md-12 col-12":"col-xl-12 col-lg-12 col-md-12 col-12"}`,children:e.jsx("div",{className:"form-create-item",style:{left:"50%"},children:e.jsxs("form",{children:[e.jsx("h4",{className:"title-create-item",children:"Tải ảnh"}),e.jsxs("label",{className:ee("uploadFile",((C=(S=l.file)==null?void 0:S.message)==null?void 0:C.length)>0?"border-danger":""),children:[a?e.jsx("span",{className:"filename",children:"PNG, JPG. tối đa 20mb."}):l.file?e.jsx("span",{className:"text-danger h5",children:l.file.message}):e.jsx("span",{className:"filename",children:"PNG, JPG. tối đa 20mb."}),e.jsx("input",{onChange:O,type:"file",className:"inputfile form-control",name:"file"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"title-create-item",children:"Tên bức tranh"}),e.jsx(Z,{control:w,error:(L=l.name)==null?void 0:L.message,id:"name",name:"name",tabIndex:"1",placeholder:"Nhập tên của bức tranh",className:"mb-15",autoFocus:!0}),e.jsx("h4",{className:"title-create-item",children:"Mô tả bức tranh"}),e.jsx(_,{control:w,id:"description",name:"description",tabIndex:"1",placeholder:"Nhập mô tả của bức tranh",className:"mb-15",autoFocus:!0}),e.jsx("div",{className:"inner-row-form style-2",children:e.jsxs("div",{id:"item-create",className:"dropdown",children:[e.jsx("h4",{className:"title-create-item",children:"Chủ đề"}),l.topic&&e.jsx("span",{className:"text-danger h5",children:l.topic.message}),e.jsxs(u,{errors:(D=l.topic)==null?void 0:D.message,children:[e.jsx(u.Select,{placeholder:G("topic","Chọn chủ đề")}),e.jsx(u.List,{children:f.map(s=>e.jsx(u.Option,{onClick:()=>q("topic",s),children:s.name},s.name))})]})]})})]}),e.jsxs("div",{className:"flex justify-content-center align-items-center mt-5",children:[e.jsx("button",{type:"submit",className:"btn-submit",onClick:I(U),children:"Lưu bản vẽ"}),e.jsx("button",{type:"submit",className:"btn-submit",onClick:I(F),children:"Nộp bản vẽ"})]})]})})})]})})}),e.jsx(M,{})]})},A=(i,a,c,d,g,f)=>{p.fire({title:i,showCancelButton:!0,confirmButtonText:"Lưu"}).then(m=>{m.isConfirmed?B.postPainting(a,c).then(()=>{p.fire(d,"","success")}).catch(j=>{p.fire(g,"Hãy thử lại sau bạn nhé","error")}):m.isDismissed&&p.fire(f,"","info")})};export{Ie as default};
