import{x as u,y as $,r as o,a as J,j as e,L as g}from"./index-t7M1JxVt.js";import{H as M}from"./HeaderVersion2-D1cqIqWh.js";import{a as X}from"./TooltipMenu-DSvONaoj.js";/* empty css                   */import{d as z}from"./imageDefault-DrZ7cyyx.js";import{u as K}from"./useUploadImage-D4zmu4MU.js";import{c as Q,d as W,a as f,o as Y}from"./object-DyP3e0Tz.js";import{u as Z}from"./index.esm-d5RgqwRU.js";import{T as _}from"./TextfieldCommon-BwNjSi2l.js";import{T as ee,S as d}from"./sweetalert2.all-BWWDaRhL.js";import{D as p}from"./index-DbuzHAlq.js";import{c as te}from"./index-BF2qtIT2.js";import"./Transition-Dx0NO2sn.js";import"./Tooltip-BCDVv4nr.js";import"./config-VkUvCR_3.js";const ie={getAllTopic:async(c,i,l,x)=>await u.get(c,{params:{AccountId:i,ContestId:l},...x})},j={postPainting:async(c,i,l)=>await u.post(c,i,l),getAllPaintingByCompetitorId:async(c,i)=>await u.get(c,i),updatePainting:async(c,i,l)=>await u.put(c,i,l)},se="paintings/draftepainting1stround",ae="paintings/submitepainting1stround",ne="paintings/listpaintingbyaccountid",Ie=()=>{var P,C,T,S;const{contestId:c}=$(),[i,l]=o.useState(null),[x,D]=o.useState(null),[L,B]=o.useState([]),[N,A]=o.useState(null),{progress:ce,url:b,error:re}=K(x),a=J(t=>t.auth.userInfo),E=new Date().toISOString().slice(0,10),[le,V]=o.useState(null);o.useEffect(()=>{(async()=>{const s=await ie.getAllTopic("roundtopics/getalltopic",a.Id,c);B(s.data.result)})()},[]);const R=Q().shape({file:W().required("Vui lòng chọn ảnh"),name:f().required("Vui lòng nhập tên của bức tranh"),description:f(),topic:f().required("Vui lòng chọn chủ đề")}),{handleSubmit:v,control:y,setValue:h,trigger:w,watch:k,setError:I,formState:{errors:m}}=Z({resolver:Y(R),reValidateMode:"onChange"}),O=t=>{const s=t.target.files[0];s.preview=URL.createObjectURL(s),l(URL.createObjectURL(s)),h("file",s),I("file",""),D(s)},U=async t=>{if(!await w())return;const n={image:b,name:t.name,description:t.description,roundTopicId:N,accountId:a.Id};d.fire({title:"Bạn có chắc chắn lưu bài?",showCancelButton:!0,confirmButtonText:"Lưu"}).then(r=>{r.isConfirmed?j.postPainting(se,n).then(()=>{d.fire("Lưu bài thành công","","success")}).catch(q=>{d.fire("Lưu bài thất bại","Hãy thử lại sau bạn nhé","error")}):r.isDenied&&d.fire("Bạn đã hủy lưu bài","","info")})},F=async t=>{if(!await w())return;const n={image:b,name:t.name,description:t.description,roundTopicId:N,accountId:a.Id};d.fire({title:"Bạn có chắc chắn nộp bài?",showCancelButton:!0,confirmButtonText:"Nộp"}).then(r=>{r.isConfirmed?j.postPainting(ae,n).then(()=>{d.fire("Nộp bài thành công","","success")}).catch(q=>{d.fire("Nộp bài thất bại","Hãy thử lại sau bạn nhé","error")}):r.isDenied&&d.fire("Bạn đã hủy nộp bài","","info")})},G=(t,s="")=>k(t)||s,H=(t,s)=>{h(t,s.name),A(s.id),I(t,"")};return o.useEffect(()=>()=>{i&&URL.revokeObjectURL(i.preview)},[i,a==null?void 0:a.Id]),o.useEffect(()=>{j.getAllPaintingByCompetitorId(ne+"/"+a.Id).then(t=>{const s=t.data.result.list.filter(r=>r.status==="Draft");t.data.result.list.filter(r=>r.status==="Submitted");const n=s[0];V(n),l(n.image),h("name",n.name),h("description",n.description),h("topic",n.topicName),h("file",n.image)})},[a==null?void 0:a.Id]),e.jsxs("div",{className:"create-item",children:[e.jsx(M,{}),e.jsxs("section",{className:"flat-title-page inner",children:[e.jsx("div",{className:"overlay"}),e.jsx("div",{className:"themesflat-container",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-md-12",children:[e.jsx("div",{className:"page-title-heading mg-bt-12",children:e.jsx("h1",{className:"heading text-center",children:"Đăng ký tham gia"})}),e.jsx("div",{className:"breadcrumbs style2",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(g,{to:"/",children:"Trang chủ"})}),e.jsx("li",{children:e.jsx(g,{to:"#",children:"Trang"})}),e.jsx("li",{children:"Đăng ký"})]})})]})})})]}),e.jsx("div",{className:"tf-create-item tf-section",children:e.jsx("div",{className:"themesflat-container",children:e.jsxs("div",{className:"row",children:[i&&e.jsxs("div",{className:"col-xl-3 col-lg-6 col-md-6 col-12",children:[e.jsx("h4",{style:{marginBottom:"20px"},className:"title-create-item",children:"Xem trước"}),e.jsxs("div",{className:"sc-card-product",children:[e.jsx("div",{className:"card-media",children:e.jsx(g,{className:"cursor-none",to:"#",children:e.jsx("img",{src:i||z,alt:"preview"})})}),e.jsxs("div",{className:"meta-info",children:[e.jsx("div",{className:"author",children:e.jsxs("div",{className:"text",children:[e.jsx("span",{children:"Tác giả"}),e.jsx("h5",{children:a.nameid})]})}),e.jsxs("div",{className:"text",children:[e.jsx("span",{children:"Ngày nộp"}),e.jsx("h5",{children:E})]})]})]})]}),e.jsx("div",{className:`${i?"col-xl-9 col-lg-6 col-md-12 col-12":"col-xl-12 col-lg-12 col-md-12 col-12"}`,children:e.jsx("div",{className:"form-create-item",style:{left:"50%"},children:e.jsxs("form",{children:[e.jsx("h4",{className:"title-create-item",children:"Tải ảnh"}),e.jsxs("label",{className:te("uploadFile",((C=(P=m.file)==null?void 0:P.message)==null?void 0:C.length)>0?"border-danger":""),children:[i?e.jsx("span",{className:"filename",children:"PNG, JPG. tối đa 20mb."}):m.file?e.jsx("span",{className:"text-danger h5",children:m.file.message}):e.jsx("span",{className:"filename",children:"PNG, JPG. tối đa 20mb."}),e.jsx("input",{onChange:O,type:"file",className:"inputfile form-control",name:"file"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"title-create-item",children:"Tên bức tranh"}),e.jsx(_,{control:y,error:(T=m.name)==null?void 0:T.message,id:"name",name:"name",tabIndex:"1",placeholder:"Nhập tên của bức tranh",className:"mb-15",autoFocus:!0}),e.jsx("h4",{className:"title-create-item",children:"Mô tả bức tranh"}),e.jsx(ee,{control:y,id:"description",name:"description",tabIndex:"1",placeholder:"Nhập mô tả của bức tranh",className:"mb-15",autoFocus:!0}),e.jsx("div",{className:"inner-row-form style-2",children:e.jsxs("div",{id:"item-create",className:"dropdown",children:[e.jsx("h4",{className:"title-create-item",children:"Chủ đề"}),m.topic&&e.jsx("span",{className:"text-danger h5",children:m.topic.message}),e.jsxs(p,{errors:(S=m.topic)==null?void 0:S.message,children:[e.jsx(p.Select,{placeholder:G("topic","Chọn chủ đề")}),e.jsx(p.List,{children:L.map(t=>e.jsx(p.Option,{onClick:()=>H("topic",t),children:t.name},t.name))})]})]})})]}),e.jsxs("div",{className:"flex justify-content-center align-items-center mt-5",children:[e.jsx("button",{type:"submit",className:"btn-submit",onClick:v(U),children:"Lưu bản vẽ"}),e.jsx("button",{type:"submit",className:"btn-submit",onClick:v(F),children:"Nộp bản vẽ"})]})]})})})]})})}),e.jsx(X,{})]})};export{Ie as default};
