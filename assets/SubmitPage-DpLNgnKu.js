import{M as ee,N as se,r as d,O as te,n as ae,o as ie,Q as C,j as e,H as ne,L as I,c as ce,S as re,T as q,e as le,U as de}from"./index-BTkpKclp.js";/* empty css                   */import{c as oe,d as me,a as P,o as he}from"./object-BYthpMTr.js";import{T as pe}from"./TextareaCommon-DRZCTNNQ.js";import{D as l}from"./index-DpNMYCVM.js";import{p as ue,a as J}from"./Status-Nhevn1i3.js";import{S as g}from"./sweetalert2.all-UxF5PBkk.js";const xe="https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",ge={get:async()=>await ee.get(xe)},je="paintings/getpaintingbyaccountcontest",Ce=()=>{var V,F,R,$,E,G,H;const{contestId:j}=se(),[c,f]=d.useState(null),[b,N]=d.useState(null),[h,y]=d.useState(null),[u,v]=d.useState([]),[o,D]=d.useState(null),[a,L]=d.useState(!1),[Q,O]=d.useState(!1),{progress:fe,url:U,error:be}=te(b),i=ae(s=>s.auth.userInfo),z=new Date().toISOString().slice(0,10),[Ne,X]=d.useState({cities:[],districts:[],wards:[],selectedCity:"",selectedDistrict:""});d.useEffect(()=>{(async()=>{const t=await de.getAllTopic("roundtopics/getalltopic",i.Id,j),r=await ge.get();v(t.data.result),X(m=>({...m,cities:r.data}))})()},[]);const K=oe().shape({file:me().required("Vui lòng chọn ảnh"),name:P().required("Vui lòng nhập tên của bức tranh"),description:P(),topic:P().required("Vui lòng chọn chủ đề")}),{handleSubmit:k,control:w,setValue:x,trigger:A,watch:W,setError:B,formState:{errors:n}}=ie({resolver:he(K),reValidateMode:"onChange"}),Y=s=>{const t=s.target.files[0];t.preview=URL.createObjectURL(t),f(URL.createObjectURL(t)),x("file",t),B("file",""),N(t)},Z=async s=>{if(!await A())return;let r={},m="",p="";h?(p="PUT",m="paintings/update",r={id:h,image:c,name:s.name,description:s.description,status:J.DRAFT,roundTopicId:o,currentUserId:i.Id}):(p="POST",m="paintings/draftepainting1stround",r={image:U,name:s.name,description:s.description,roundTopicId:o,accountId:i.Id}),M("Bạn có chắc chắn lưu bài?",m,p,r,"Lưu bài thành công","Lưu bài thất bại","Bạn đã hủy lưu bài",O)},_=async s=>{if(!await A())return;let r={},m="",p="";h?(p="PUT",m="paintings/update",r={id:h,image:c,name:s.name,description:s.description,status:J.SUBMITTED,roundTopicId:o,currentUserId:i.Id}):(p="POST",m="paintings/submitepainting1stround",r={image:U,name:s.name,description:s.description,roundTopicId:o,accountId:i.Id}),M("Bạn có chắc chắn nộp bài?",m,p,r,"Nộp bài thành công","Nộp bài thất bại","Bạn đã hủy nộp bài",O)},S=(s,t="")=>W(s)||t,T=(s,t)=>{x(s,t.name),D(t.id),B(s,"")};return d.useEffect(()=>()=>{c&&URL.revokeObjectURL(c.preview)},[c,i==null?void 0:i.Id]),d.useEffect(()=>{C.getAllPaintingByContestAccountId(je,j,i==null?void 0:i.Id).then(s=>{const t=s.data.result;f(t.image),y(t.id),x("name",t.name),x("description",t.description),x("topic",t.topicName),D(t.roundTopicId),x("file",t.image),ue.some(r=>r===t.status)?L(!0):L(!1)})},[i==null?void 0:i.Id,j,Q]),e.jsxs("div",{className:"create-item",children:[e.jsx(ne,{}),e.jsxs("section",{className:"flat-title-page inner",children:[e.jsx("div",{className:"overlay"}),e.jsx("div",{className:"themesflat-container",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-md-12",children:[e.jsx("div",{className:"page-title-heading mg-bt-12",children:e.jsx("h1",{className:"heading text-center",children:"Đăng ký tham gia"})}),e.jsx("div",{className:"breadcrumbs style2",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(I,{to:"/",children:"Trang chủ"})}),e.jsx("li",{children:e.jsx(I,{to:"#",children:"Trang"})}),e.jsx("li",{children:"Đăng ký"})]})})]})})})]}),e.jsx("div",{className:"tf-create-item tf-section",children:e.jsx("div",{className:"themesflat-container",children:e.jsxs("div",{className:"row",children:[c&&e.jsxs("div",{className:"col-xl-3 col-lg-6 col-md-6 col-12",children:[e.jsx("h4",{style:{marginBottom:"20px"},className:"title-create-item",children:"Xem trước"}),e.jsxs("div",{className:"sc-card-product",children:[e.jsx("div",{className:"card-media",children:e.jsx(I,{className:"cursor-none",to:"#",children:e.jsx("img",{src:c||ce,alt:"preview"})})}),e.jsxs("div",{className:"meta-info",children:[e.jsx("div",{className:"author",children:e.jsxs("div",{className:"text",children:[e.jsx("span",{children:"Tác giả"}),e.jsx("h5",{children:i.nameid})]})}),e.jsxs("div",{className:"text",children:[e.jsx("span",{children:"Ngày nộp"}),e.jsx("h5",{children:z})]})]})]})]}),e.jsx("div",{className:`${c?"col-xl-9 col-lg-6 col-md-12 col-12":"col-xl-12 col-lg-12 col-md-12 col-12"}`,children:e.jsx("div",{className:"form-create-item",style:{left:"50%"},children:e.jsxs("form",{children:[e.jsx("h4",{className:"title-create-item",children:"Tải ảnh"}),e.jsxs("label",{className:re(a?"read-only":"","uploadFile",((F=(V=n.file)==null?void 0:V.message)==null?void 0:F.length)>0?"border-danger":""),children:[c?e.jsx("span",{className:"filename",children:"PNG, JPG. tối đa 20mb."}):n.file?e.jsx("span",{className:"text-danger h5",children:n.file.message}):e.jsx("span",{className:"filename",children:"PNG, JPG. tối đa 20mb."}),e.jsx("input",{onChange:Y,type:"file",className:`${a?"read-only":""} inputfile form-control`,name:"file",disabled:a})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"title-create-item disable-select",children:"Tên bức tranh"}),e.jsx(q,{control:w,error:(R=n.name)==null?void 0:R.message,id:"name",name:"name",tabIndex:"1",placeholder:"Nhập tên của bức tranh",className:`${a?"read-only":""} mb-15`,autoFocus:!0,disabled:a,readOnly:a}),e.jsx("h4",{className:"title-create-item",children:"Mô tả bức tranh"}),e.jsx(pe,{control:w,id:"description",name:"description",tabIndex:"1",placeholder:"Nhập mô tả của bức tranh",className:`${a?"read-only":""} mb-15`,autoFocus:!0,disabled:a}),e.jsx("div",{className:"inner-row-form style-2",children:e.jsxs("div",{id:"item-create",className:"dropdown",children:[e.jsx("h4",{className:"title-create-item",children:"Chủ đề"}),n.topic&&e.jsx("span",{className:"text-danger h5",children:n.topic.message}),e.jsxs(l,{disabled:a,classname:"mb-15",errors:($=n.topic)==null?void 0:$.message,children:[e.jsx(l.Select,{placeholder:S("topic","Chọn chủ đề")}),e.jsx(l.List,{children:u.map(s=>e.jsx(l.Option,{onClick:()=>T("topic",s),children:s.name},s.name))})]})]})}),e.jsxs("div",{className:"flex align-items-start mb-15",children:[e.jsx("div",{className:"inner-row-form style-2 w-50 mr-5",children:e.jsxs("div",{id:"item-create",className:"dropdown",children:[e.jsx("h4",{className:"title-create-item",children:"Quận"}),n.district&&e.jsx("span",{className:"text-danger h5",children:n.district.message}),e.jsxs(l,{disabled:a,errors:(E=n.district)==null?void 0:E.message,children:[e.jsx(l.Select,{placeholder:S("district","Chọn quận")}),e.jsx(l.List,{children:u.map(s=>e.jsx(l.Option,{onClick:()=>T("topic",s),children:s.name},s.name))})]})]})}),e.jsx("div",{className:"inner-row-form style-2 w-50",children:e.jsxs("div",{id:"item-create",className:"dropdown",children:[e.jsx("h4",{className:"title-create-item",children:"Phường"}),n.ward&&e.jsx("span",{className:"text-danger h5",children:n.ward.message}),e.jsxs(l,{disabled:a,errors:(G=n.ward)==null?void 0:G.message,children:[e.jsx(l.Select,{placeholder:S("ward","Chọn phường")}),e.jsx(l.List,{children:u.map(s=>e.jsx(l.Option,{onClick:()=>T("topic",s),children:s.name},s.name))})]})]})})]}),e.jsx("h4",{className:"title-create-item disable-select",children:"Địa chỉ cụ thể"}),e.jsx(q,{control:w,error:(H=n.adress)==null?void 0:H.message,id:"adress",name:"adress",placeholder:"Nhập địa chỉ cụ thể như số nhà, tên đường, trường, lớp, ....",className:`${a?"read-only":""} mb-15`,autoFocus:!0,disabled:a,readOnly:a})]}),e.jsxs("div",{className:"flex justify-content-center align-items-center mt-5",children:[e.jsx("button",{type:"submit",className:`${a?"button-read-only":""} btn-submit`,disabled:a,onClick:k(Z),children:"Lưu bản vẽ"}),e.jsx("button",{type:"submit",className:`${a?"button-read-only":""} btn-submit`,disabled:a,onClick:k(_),children:"Nộp bản vẽ"})]})]})})})]})})}),e.jsx(le,{})]})},M=(j,c,f,b,N,h,y,u)=>{g.fire({title:j,showCancelButton:!0,confirmButtonText:"Lưu"}).then(v=>{v.isConfirmed?f==="POST"?C.postPainting(c,b).then(()=>{g.fire(N,"","success").then(()=>{u(o=>!o)})}).catch(o=>{g.fire(h,"Hãy thử lại sau bạn nhé","error")}):f==="PUT"&&C.updatePainting(c,b).then(()=>{g.fire(N,"","success").then(()=>{u(o=>!o)})}).catch(o=>{g.fire(h,"Hãy thử lại sau bạn nhé","error")}):v.isDismissed&&g.fire(y,"","info")})};export{Ce as default};
